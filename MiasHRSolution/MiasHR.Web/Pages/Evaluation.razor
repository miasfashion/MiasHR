@page "/evaluation"

<PageTitle>Self Evaluation</PageTitle>
<UserNameCard />
@*TODO: Term and Year should be taken from the data sources
        Information located in HR_General_Code class= 19, org_code = MIas
*@
<MudText Class="p-2 " Typo="Typo.h3">Self Evaluation: 2023 Year End</MudText>
<MudPaper Class="m-3 p-3 w-25">
    <MudTextField Class="m-3" @bind-Value="year" Label="Year" Variant="Variant.Outlined" Validation="@(new Func<string, IEnumerable<string>>(YearCheck))" Required="true"
        RequiredError="Type Year to Search"/>
    <MudSelect Class="m-3" T="string" @bind-Value="@defaultTerm" Label="Term" AnchorOrigin="Origin.BottomCenter" Required="true" RequiredError="Choose Term to Evaluate">
        <MudSelectItem Value="@("Half")" />
        <MudSelectItem Value="@("Year End")" />
    </MudSelect>
    <MudButton Class="m-3" Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.Search" Color="Color.Primary">Search</MudButton>
</MudPaper>
<MudTable Items="@factorLists"
    Class="d-flex m-5 ml-4 w-75"
    Striped="@strip" Dense="@dense" Hover="@hover">
    <HeaderContent>
        <MudTh>Factor</MudTh>
        <MudTh>Grade</MudTh>
        <MudTh>Grade Description</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Factor">@context.Factor</MudTd>
        <MudTd DataLabel="Grade">@context.Grade</MudTd>
        <MudTd DataLabel="GradeDesc">@context.GradeDesc</MudTd>
    </RowTemplate>
</MudTable>
<MudTextField Class="m-3" @bind-Value="comment" Label="Comment" Variant="Variant.Outlined" />
<MudButton Class="m-4 float-end" Variant="Variant.Filled"  EndIcon="@Icons.Material.Filled.Save" Color="Color.Primary">Submit</MudButton>
    @code {
    public string defaultTerm { get; set; } = "Half";
    public string year { get; set; }
    public string comment { get; set; } = "";
    private bool dense = true;
    private bool hover = true;
    private bool strip = true;
    
    //Check valid year length
    private IEnumerable<string> YearCheck(string pw)
    {
        if (string.IsNullOrWhiteSpace(pw))
        {
            yield return "Year is required!";
            yield break;
        }
        if (pw.Length != 4){
            yield return "Type correct year";
             yield break;
        }

    }



    @*TODO: Implement function to use values from entity*@

    //Factors (changes based on the group code)
    public class FactorList
    {
        public string? Factor { get; set; }
        public string? Grade { get; set; }
        public string? GradeDesc { get; set; }
    }
    

    //Factor grades and descriptions are in HR_EVAL_FACTOR_DETAI and has assigned point to it
    //Current HR site has Factor Code hidden in the grid
    List<FactorList> factorLists = new List<FactorList>()
    {
        new FactorList { Factor="Knowledge of Job",Grade="B",GradeDesc="Have a great wealth of knowledge about all job facets"},
        new FactorList { Factor="Dedication to Work", Grade="C", GradeDesc="Completes work well enough to pass minimum standards"},
        new FactorList { Factor="Quality Management", Grade="D", GradeDesc="Defect rate in some processes unacceptable"}
    };
}
